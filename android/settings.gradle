pluginManagement {
    def getFlutterSdkPath = {
        def propertiesFile = file("local.properties")
        if (!propertiesFile.exists()) {
            throw new GradleException("local.properties file not found. Make sure the file exists and contains 'flutter.sdk'.")
        }

        def properties = new Properties()
        propertiesFile.withInputStream { properties.load(it) }

        def flutterSdkPath = properties.getProperty("flutter.sdk")
        if (flutterSdkPath == null) {
            throw new GradleException("flutter.sdk not set in local.properties. Add 'flutter.sdk=/path/to/flutter' to fix this.")
        }

        return flutterSdkPath
    }

    def flutterSdkPath = getFlutterSdkPath()

    includeBuild("${flutterSdkPath}/packages/flutter_tools/gradle")
}

include ":app"
